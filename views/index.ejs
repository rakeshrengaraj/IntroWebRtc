<!DOCTYPE html>
<html>

<head>
    <title>Introduction to WebRTC</title>
    <link rel="stylesheet" type="text/css" href="style.css" </head>

<body>
    <div>
        Video: <select id="camera"></select>
    </div>
    <div>
        <video autoplay></video>
    </div>

    <script>

        var videoArea = document.querySelector('video');
        var videoSelect = document.querySelector('#camera');

        navigator.mediaDevices.enumerateDevices()
            .then(function (sources) {
                getCameras(sources);
            })

        videoSelect.onChange = startStream;
        startStream();


        function getCameras(sourceInfos) {
            for (var i = 0; i != sourceInfos.length; i++) {
                var sourceInfo = sourceInfos[i];
                console.log("sourceInfo ", sourceInfo)
                var option = document.createElement('option');
                option.value = sourceInfo.groupId;
                if (sourceInfo.kind === 'videoinput') {
                    console.log("Video Entered")
                    option.text = sourceInfo.label || 'camera ' + (videoSelect.length + 1);
                    videoSelect.appendChild(option);
                }

            }
        }

        function startStream() {
            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;


            var constraints = {
                audio: false,
                video: {
                    mandatory: {
                        minWidth: 320,
                        minHeight: 180
                    }
                }
            };
            navigator.getUserMedia(constraints, onSuccess, onError);
        }



        function onSuccess(stream) {
            console.log("Success! We have a stream!!");
            console.log(stream);

            // videoArea.src = window.URL.createObjectURL(stream);

            videoArea.srcObject = stream;
            videoArea.className = 'grayscale_filter';

            videoArea.play();
        }

        function onError(error) {
            console.log("Error with getUserMedia");
        }
    </script>

</body>

</html>